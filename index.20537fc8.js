function e(e){return e.hauteur}function t(e){return e.z_min-e.hauteur}function o(e,t,o,i){const n=itowns.THREE,r=new n.SphereGeometry(10,32,16),s=new n.MeshBasicMaterial({color:"rgb(0, 255, 0)"}),a=new n.Mesh(r,s),l=i.controls.getLookAtCoordinate();return l.altitude+=30,l.x=e,l.y=t,a.position.copy(l.as(i.referenceCrs)),a.updateMatrixWorld(),i.scene.add(a),i.mesh=a,i.notifyChange(),a}const i=document.getElementById("viewerDiv"),n=itowns.THREE,r={coord:new itowns.Coordinates("EPSG:4326",4.83518,45.7613),range:3e3,tilt:60};let s=new itowns.GlobeView(i,r,{atmosphere:{Kr:.05,Km:.15,ESun:100,g:100,innerRadius:637e4,outerRadius:6370001,wavelength:[.7],scaleDepth:.38}});s.getLayerById("atmosphere").setRealisticOn(!0);const a=function(e,t,o,i,n){const r=new itowns.WMTSSource({url:e,crs:t,name:o,tileMatrixSet:i,format:n});return new itowns.ColorLayer("Ortho",{source:r})}("https://wxs.ign.fr/3ht7xcw6f7nciopo16etuqp2/geoportail/wmts","EPSG:3857","ORTHOIMAGERY.ORTHOPHOTOS","PM","image/jpeg");s.addLayer(a);const l=function(e,t,o,i,n){const r=new itowns.WMTSSource({url:e,crs:t,name:o,tileMatrixSet:i,format:n,tileMatrixSetLimits:{11:{minTileRow:442,maxTileRow:1267,minTileCol:1344,maxTileCol:2683},12:{minTileRow:885,maxTileRow:2343,minTileCol:3978,maxTileCol:5126},13:{minTileRow:1770,maxTileRow:4687,minTileCol:7957,maxTileCol:10253},14:{minTileRow:3540,maxTileRow:9375,minTileCol:15914,maxTileCol:20507}}});return new itowns.ElevationLayer("MNT_WORLD",{source:r})}("https://wxs.ign.fr/3ht7xcw6f7nciopo16etuqp2/geoportail/wmts","EPSG:4326","ELEVATION.ELEVATIONGRIDCOVERAGE.HIGHRES","WGS84G","image/x-bil;bits=32");s.addLayer(l);const c=function(o,i,n,r,s,a){const l=new itowns.WFSSource({url:o,typeName:i,crs:n,extent:s});let c={};return{layer:new itowns.FeatureGeometryLayer("Buildings",{source:l,zoom:{min:r},style:new itowns.Style({fill:{color:function(e){Object.keys(c).includes(e.id)&&console.log(e.id);return new itowns.THREE.Color("rgb(255, 255, 255)")},base_altitude:t,extrusion_height:e}}),onMeshCreated:function(e,t){e.children.forEach((e=>{let t=e.children[0].children[0].children[0].feature.geometries,o=0;t.map((e=>{if(o++,o%50==0){let t=e.properties.id;c[t]={id:t,batMesh:e,position:{x:(e.properties.bbox[0]+e.properties.bbox[2])/2,y:(e.properties.bbox[1]+e.properties.bbox[3])/2,z:e.properties.z_min},virusProbability:Math.random()}}}))}))}}),coords:c,src:l}}("https://wxs.ign.fr/3ht7xcw6f7nciopo16etuqp2/geoportail/wfs?","BDTOPO_BDD_WLD_WGS84G:bati_indifferencie","EPSG:4326",14,{west:4.77244,east:4.87408,south:45.71694,north:45.80481}),d=c.layer,u=c.coords;let m;s.addLayer(d);var p=100;function h(e){let t,o=Object.keys(e),i=o.length;Object.entries(e).forEach((function([e,n]){var r,s,a,l,c;n.mesh&&n.destination&&n.mesh.position&&(n.elapsed=(r=n.mesh,s=n.mesh.position,a=n.destination,l=n.elapsed,c=++l/(1e4*p),r.position.lerpVectors(s,a,c),r.updateMatrixWorld(),l),n.mesh.position.distanceTo(n.destination)<50&&(n.elapsed>1&&n.mesh.material.color.set("rgb(255, 0, 0)"),t=o[Math.floor(Math.random()*i)],n.destination=m[t].posBuilding))}))}function w(){requestAnimationFrame(w),h(u),s.mainLoop.gfxEngine.renderer.render(s.scene,s.camera.camera3D)}s.addEventListener(itowns.GLOBE_VIEW_EVENTS.GLOBE_INITIALIZED,(function(){let e,t;console.info("Globe initialized");let i=Object.keys(u),r=i.length;Object.entries(u).forEach((function([n,a]){t=i[Math.floor(Math.random()*r)],e=o(a.position.x,a.position.y,a.position.z,s),u[n].mesh=e,u[n].posBuilding=e.position})),Object.entries(u).forEach((function([e,o]){t=i[Math.floor(Math.random()*r)],u[e].destination=u[t].posBuilding,u[e].elapsed=0;const a=[];a.push(u[e].posBuilding),a.push(u[t].posBuilding);const l=(new n.BufferGeometry).setFromPoints(a),c=new n.LineBasicMaterial({color:255}),d=new n.Line(l,c);s.scene.add(d)})),m=JSON.parse(JSON.stringify(u)),w()}));
//# sourceMappingURL=index.20537fc8.js.map
