function e(e){return e.hauteur}function t(e){return e.z_min-e.hauteur}function o(e,t,o,i){const n=itowns.THREE,r=new n.SphereGeometry(10,32,16),s=new n.MeshBasicMaterial({color:"rgb(0, 255, 0)"}),a=new n.Mesh(r,s),l=i.controls.getLookAtCoordinate();return l.altitude+=30,l.x=e,l.y=t,a.position.copy(l.as(i.referenceCrs)),a.updateMatrixWorld(),i.scene.add(a),i.mesh=a,i.notifyChange(),a}const i=document.getElementById("viewerDiv"),n=itowns.THREE,r={coord:new itowns.Coordinates("EPSG:4326",4.83518,45.7613),range:3e3,tilt:60};let s=new itowns.GlobeView(i,r,{atmosphere:{Kr:.05,Km:.15,ESun:100,g:100,innerRadius:637e4,outerRadius:6370001,wavelength:[.7],scaleDepth:.38}});s.getLayerById("atmosphere").setRealisticOn(!0);const a=function(e,t,o,i,n){const r=new itowns.WMTSSource({url:e,crs:t,name:o,tileMatrixSet:i,format:n});return new itowns.ColorLayer("Ortho",{source:r})}("http://wxs.ign.fr/3ht7xcw6f7nciopo16etuqp2/geoportail/wmts","EPSG:3857","ORTHOIMAGERY.ORTHOPHOTOS","PM","image/jpeg");s.addLayer(a);const l=function(e,t,o,i,n){const r=new itowns.WMTSSource({url:e,crs:t,name:o,tileMatrixSet:i,format:n,tileMatrixSetLimits:{11:{minTileRow:442,maxTileRow:1267,minTileCol:1344,maxTileCol:2683},12:{minTileRow:885,maxTileRow:2343,minTileCol:3978,maxTileCol:5126},13:{minTileRow:1770,maxTileRow:4687,minTileCol:7957,maxTileCol:10253},14:{minTileRow:3540,maxTileRow:9375,minTileCol:15914,maxTileCol:20507}}});return new itowns.ElevationLayer("MNT_WORLD",{source:r})}("http://wxs.ign.fr/3ht7xcw6f7nciopo16etuqp2/geoportail/wmts","EPSG:4326","ELEVATION.ELEVATIONGRIDCOVERAGE.HIGHRES","WGS84G","image/x-bil;bits=32");s.addLayer(l);const c=function(o,i,n,r,s,a){const l=new itowns.WFSSource({url:o,typeName:i,crs:n,extent:s});let c={};return{layer:new itowns.FeatureGeometryLayer("Buildings",{source:l,zoom:{min:r},style:new itowns.Style({fill:{color:function(e){Object.keys(c).includes(e.id)&&console.log(e.id);return new itowns.THREE.Color("rgb(255, 255, 255)")},base_altitude:t,extrusion_height:e}}),onMeshCreated:function(e,t){e.children.forEach((e=>{let t=e.children[0].children[0].children[0].feature.geometries,o=0;t.map((e=>{if(o++,o%20==0){let t=e.properties.id;c[t]={id:t,batMesh:e,position:{x:(e.properties.bbox[0]+e.properties.bbox[2])/2,y:(e.properties.bbox[1]+e.properties.bbox[3])/2,z:e.properties.z_min},virusProbability:Math.random()}}}))}))}}),coords:c,src:l}}("http://wxs.ign.fr/3ht7xcw6f7nciopo16etuqp2/geoportail/wfs?","BDTOPO_BDD_WLD_WGS84G:bati_indifferencie","EPSG:4326",14,{west:4.77244,east:4.87408,south:45.71694,north:45.80481}),u=c.layer,m=c.coords;let d;console.log("test"),s.addLayer(u);var p=100;function w(e){Object.keys(e).length;Object.entries(e).forEach((function([e,t]){t.mesh&&t.destination&&t.mesh.position&&(t.elapsed=function(e,t,o,i){var r=++i/(1e4*p);e.position.lerpVectors(t,o,r),e.updateMatrixWorld();const a=[];a.push(t),a.push(e.position);const l=(new n.BufferGeometry).setFromPoints(a),c=new n.LineBasicMaterial({color:255}),u=new n.Line(l,c);return s.scene.add(u),i}(t.mesh,t.mesh.position,t.destination,t.elapsed),t.mesh.position.distanceTo(t.destination)<50&&t.elapsed>1&&t.mesh.material.color.set("rgb(255, 0, 0)"))}))}function h(){requestAnimationFrame(h),w(m),s.mainLoop.gfxEngine.renderer.render(s.scene,s.camera.camera3D)}s.addEventListener(itowns.GLOBE_VIEW_EVENTS.GLOBE_INITIALIZED,(function(){let e,t;console.info("Globe initialized");let i=Object.keys(m),n=i.length;Object.entries(m).forEach((function([r,a]){t=i[Math.floor(Math.random()*n)],e=o(a.position.x,a.position.y,a.position.z,s),m[r].mesh=e,m[r].posBuilding=e.position})),Object.entries(m).forEach((function([e,o]){t=i[Math.floor(Math.random()*n)],m[e].destination=m[t].posBuilding,m[e].elapsed=0})),d=JSON.parse(JSON.stringify(m)),console.log(d),h()}));
//# sourceMappingURL=index.a99d3b32.js.map
